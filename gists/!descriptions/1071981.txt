{
  "git_push_url": "git@gist.github.com:1071981.git",
  "fork_of": {
    "git_push_url": "git@gist.github.com:900050.git",
    "updated_at": "2011-04-03T01:07:17Z",
    "public": true,
    "html_url": "https://gist.github.com/900050",
    "files": {
      "stations.json": {
        "type": "application/json",
        "filename": "stations.json",
        "language": "JSON",
        "raw_url": "https://gist.github.com/raw/900050/f5b132f98e3d30bfe193c5e9c5bc5fc6b75aba5f/stations.json",
        "size": 2098
      },
      "tiler.js": {
        "type": "application/javascript",
        "filename": "tiler.js",
        "language": "JavaScript",
        "raw_url": "https://gist.github.com/raw/900050/5124c880fb7c4ce0a80548a371263ee94b5f3573/tiler.js",
        "size": 2478
      },
      "index.html": {
        "type": "text/html",
        "filename": "index.html",
        "language": "HTML",
        "raw_url": "https://gist.github.com/raw/900050/92daa8f65b083350de1e0832677a6c0f781dcba3/index.html",
        "size": 2818
      }
    },
    "user": {
      "avatar_url": "https://secure.gravatar.com/avatar/005a27e09fe946ebef64bf4d134efc0a?d=https://a248.e.akamai.net/assets.github.com%2Fimages%2Fgravatars%2Fgravatar-user-420.png",
      "gravatar_id": "005a27e09fe946ebef64bf4d134efc0a",
      "url": "https://api.github.com/users/mbostock",
      "login": "mbostock",
      "id": 230541
    },
    "url": "https://api.github.com/gists/900050",
    "description": "d3.geo.tiler",
    "git_pull_url": "git://gist.github.com/900050.git",
    "id": "900050",
    "comments": 0,
    "created_at": "2011-04-03T00:24:50Z"
  },
  "forks": [

  ],
  "updated_at": "2011-07-08T14:39:45Z",
  "public": true,
  "html_url": "https://gist.github.com/1071981",
  "files": {
    "stations.json": {
      "type": "application/json",
      "filename": "stations.json",
      "language": "JSON",
      "raw_url": "https://gist.github.com/raw/1071981/f5b132f98e3d30bfe193c5e9c5bc5fc6b75aba5f/stations.json",
      "content": "{\"KMAE\":[-120.12,36.98,\"MADERA MUNICIPAL AIRPORT\",[26,1,2,5,6,3,2,1,2,7,29,12,3]],\"KSJC\":[-121.92,37.37,\"SAN JOSE INTERNATIONAL  AIRPORT\",[28,1,1,1,6,10,5,3,2,4,14,21,7]],\"KMCE\":[-120.50,37.28,\"MERCED MUNICIPAL AIRPORT\",[29,1,1,3,7,5,2,1,3,6,12,26,5]],\"KMER\":[-120.57,37.37,\"Merced / Castle Air Force Base\",[34,1,1,1,4,5,2,1,1,4,17,22,7]],\"KAPC\":[-122.28,38.20,\"NAPA COUNTY AIRPORT\",[23,2,1,6,3,3,8,18,11,13,4,3,5]],\"KSUU\":[-121.95,38.27,\"Fairfield / Travis Air Force Base\",[13,7,4,3,3,6,4,13,33,4,1,2,7]],\"KSQL\":[-122.25,37.52,\"San Carlos Airport\",[18,3,2,2,3,4,3,2,5,17,16,12,12]],\"KSNS\":[-121.60,36.67,\"SALINAS MUNICIPAL AIRPORT\",[21,1,1,6,12,3,1,2,9,21,17,5,1]],\"KMOD\":[-120.95,37.62,\"MODESTO CITY CO SHAM FLD\",[27,1,1,2,10,5,1,1,1,3,17,24,8]],\"KOAK\":[-122.23,37.72,\"METRO OAKLAND INTERNATIONAL  AIRPORT \",[16,3,3,2,4,6,3,4,9,23,20,6,2]],\"KSCK\":[-121.23,37.90,\"STOCKTON METROPOLITAN AIRPORT \",[21,2,2,3,6,8,2,1,4,15,19,12,4]],\"KCCR\":[-122.05,38.00,\"CONCORD BUCHANAN FIELD\",[24,3,2,1,1,5,17,12,9,9,7,6,4]],\"KMRY\":[-121.85,36.58,\"MONTEREY PENINSULA AIRPORT\",[26,1,2,9,5,3,4,9,13,14,9,4,1]],\"KPAO\":[-122.12,37.47,\"Palo Alto Airport\",[31,3,1,1,2,5,1,1,1,4,10,25,14]],\"KSAC\":[-121.50,38.50,\"SACRAMENTO EXECUTIVE AIRPORT \",[32,1,0,1,3,11,12,16,5,2,4,9,3]],\"KHWD\":[-122.12,37.67,\"HAYWARD AIR TERMINAL\",[20,2,7,2,2,6,3,3,6,23,18,6,2]],\"KSTS\":[-122.82,38.50,\"SANTA ROSA SONOMA COUNTY\",[46,1,0,1,5,13,10,4,3,3,4,6,3]],\"KSMF\":[-121.60,38.70,\"SACRAMENTO INTERNATIONAL  AIRPORT\",[19,2,1,2,4,21,18,8,3,2,5,12,4]],\"KNUQ\":[-122.05,37.43,\"MOFFETT FIELD\",[35,3,1,1,4,7,2,1,2,5,6,17,15]],\"KRHV\":[-121.82,37.33,\"San Jose / Reid / Hillv\",[35,0,0,1,4,4,2,1,1,10,28,11,1]],\"KWVI\":[-121.78,36.93,\"WATSONVILLE MUNICIPAL AIRPORT \",[44,1,2,3,4,5,7,9,8,4,6,5,2]],\"KMHR\":[-121.30,38.55,\"Sacramento, Sacramento Mather Airport\",[21,1,1,2,8,15,12,12,7,4,5,7,3]],\"KVCB\":[-121.95,38.38,\"VACAVILLE NUT TREE AIRPORT\",[36,2,1,1,2,6,10,18,10,2,2,5,6]],\"KSFO\":[-122.37,37.62,\"SAN FRANCISCO INTERNATIONAL  AIRPORT \",[13,3,3,2,3,4,4,4,7,31,20,2,3]],\"KLVK\":[-121.82,37.70,\"LIVERMORE MUNICIPAL AIRPORT \",[32,2,7,3,1,1,2,7,9,17,16,2,1]]}\n",
      "size": 2098
    },
    "tiler.js": {
      "type": "application/javascript",
      "filename": "tiler.js",
      "language": "JavaScript",
      "raw_url": "https://gist.github.com/raw/1071981/5124c880fb7c4ce0a80548a371263ee94b5f3573/tiler.js",
      "content": "d3.geo.tiler = function() {\n  var tiler = {},\n      points = [],\n      projection = d3.geo.mercator().scale(1).translate([.5, .5]),\n      location = Object, // identity function\n      zoom = 8,\n      root = null;\n\n  function build(points, x, y, z) {\n    if (z >= zoom) return points.map(d3_geo_tilerData);\n    var i = -1,\n        n = points.length,\n        c = [[], [], [], []],\n        k = 1 << z++,\n        p;\n    while (++i < n) {\n      p = points[i];\n      var x1 = (p[0] * k - x) >= .5,\n          y1 = (p[1] * k - y) >= .5;\n      c[x1 << 1 | y1].push(p);\n    }\n    x <<= 1;\n    y <<= 1;\n    return {\n      \"0\": c[0].length && build(c[0], x    , y    , z),\n      \"1\": c[1].length && build(c[1], x    , y + 1, z),\n      \"2\": c[2].length && build(c[2], x + 1, y    , z),\n      \"3\": c[3].length && build(c[3], x + 1, y + 1, z)\n    };\n  }\n\n  tiler.location = function(x) {\n    if (!arguments.length) return location;\n    location = x;\n    root = null; // reset\n    return tiler;\n  };\n\n  tiler.projection = function(x) {\n    if (!arguments.length) return projection;\n    projection = x;\n    root = null; // reset\n    return tiler;\n  };\n\n  tiler.zoom = function(x) {\n    if (!arguments.length) return zoom;\n    zoom = x;\n    root = null; // reset\n    return tiler;\n  };\n\n  tiler.points = function(x) {\n    if (!arguments.length) return points;\n    points = x;\n    root = null; // reset\n    return tiler;\n  };\n\n  tiler.tile = function(x, y, z) {\n    var results = [];\n\n    // Lazy initialization…\n    // Project the points to normalized coordinates in [0, 1].\n    if (!root) {\n      root = build(points.map(function(d, i) {\n        var point = projection(location.call(tiler, d, i));\n        point.data = d;\n        return point;\n      }), 0, 0, 0);\n    }\n\n    function search(node, x0, y0, z0) {\n      if (!node) return;\n      if (z0 < z) {\n        var k = Math.pow(2, z0 - z),\n            x1 = (x * k - x0) >= .5,\n            y1 = (y * k - y0) >= .5;\n        search(node[x1 << 1 | y1], x0 << 1 | x1, y0 << 1 | y1, z0 + 1);\n      } else {\n        accumulate(node);\n      }\n    }\n\n    function accumulate(node) {\n      if (node.length) {\n        for (var i = -1, n = node.length; ++i < n;) {\n          results.push(node[i]);\n        }\n      } else {\n        for (var i = -1; ++i < 4;) {\n          if (node[i]) accumulate(node[i]);\n        }\n      }\n    }\n\n    search(root, 0, 0, 0);\n    return results;\n  };\n\n  return tiler;\n};\n\nfunction d3_geo_tilerData(d) {\n  return d.data;\n}\n",
      "size": 2478
    },
    "index.html": {
      "type": "text/html",
      "filename": "index.html",
      "language": "HTML",
      "raw_url": "https://gist.github.com/raw/1071981/92daa8f65b083350de1e0832677a6c0f781dcba3/index.html",
      "content": "<!DOCTYPE html>\n<html>\n  <head>\n    <script type=\"text/javascript\" src=\"https://github.com/mbostock/d3/raw/v1.8.4/d3.js\"></script>\n    <script type=\"text/javascript\" src=\"https://github.com/mbostock/d3/raw/v1.8.4/d3.geo.js\"></script>\n    <script type=\"text/javascript\" src=\"https://github.com/simplegeo/polymaps/raw/v2.4.0/polymaps.js\"></script>\n    <script type=\"text/javascript\" src=\"tiler.js\"></script>\n    <style type=\"text/css\">\n\n@import url(\"http://github.com/simplegeo/polymaps/raw/v2.4.0/examples/example.css\");\n\nhtml, body {\n  height: 100%;\n  background: #E6E6E6;\n  margin: 0;\n  font: 10px sans-serif;\n}\n\nsvg {\n  display: block;\n}\n\ncircle {\n  stroke: black;\n  fill: brown;\n  fill-opacity: .5;\n}\n\n#map {\n  width: 960px;\n  height: 500px;\n}\n\n    </style>\n  </head>\n  <body>\n    <div id=\"map\"></div>\n    <script type=\"text/javascript\">\n\nvar po = org.polymaps;\n\n// Create the map object, add it to #map…\nvar map = po.map()\n    .container(d3.select(\"#map\").append(\"svg:svg\").node())\n    .zoom(8)\n    .add(po.drag())\n    .add(po.wheel().smooth(false))\n    .add(po.dblclick())\n    .add(po.arrow());\n\n// Add the CloudMade image tiles as a base layer…\nmap.add(po.image()\n    .url(po.url(\"http://{S}tile.cloudmade.com\"\n    + \"/1a1b06b230af4efdbb989ea99e9841af\" // http://cloudmade.com/register\n    + \"/998/256/{Z}/{X}/{Y}.png\")\n    .hosts([\"a.\", \"b.\", \"c.\", \"\"])));\n\n// Add the custom stations layer…\nmap.add(stations(\"stations.json\"));\n\n// Add the compass control on top.\nmap.add(po.compass()\n    .pan(\"none\"));\n\n// Custom layer implementation.\nfunction stations(url) {\n\n  // Create the tiler, for organizing our points into tile boundaries.\n  var tiler = d3.geo.tiler()\n      .zoom(11)\n      .location(function(d) { return d.value; });\n\n  // Create the base layer object, using our tile factory.\n  var layer = po.layer(load);\n\n  // Load the station data. When the data comes back, reload.\n  d3.json(url, function(json) {\n    tiler.points(d3.entries(json));\n    layer.reload();\n  });\n\n  // Custom tile implementation.\n  function load(tile, projection) {\n    projection = projection(tile).locationPoint;\n\n    // Add an svg:g for each station.\n    var g = d3.select(tile.element = po.svg(\"g\")).selectAll(\"g\")\n        .data(tiler.tile(tile.column, tile.row, tile.zoom))\n      .enter().append(\"svg:g\")\n        .attr(\"transform\", transform);\n\n    // Add a circle.\n    g.append(\"svg:circle\")\n        .style(\"fill\", d3.hsl(Math.random() * 360, 1, .5))\n        .attr(\"r\", 4.5);\n\n    // Add a label.\n    g.append(\"svg:text\")\n        .attr(\"x\", 7)\n        .attr(\"dy\", \".31em\")\n        .text(function(d) { return d.key; });\n\n    function transform(d) {\n      d = projection({lon: d.value[0], lat: d.value[1]});\n      return \"translate(\" + d.x + \",\" + d.y + \")\";\n    }\n  }\n\n  return layer;\n}\n\n    </script>\n  </body>\n</html>\n",
      "size": 2818
    }
  },
  "user": {
    "avatar_url": "https://secure.gravatar.com/avatar/3dfe581ced82b6ab7d10429bc60541e1?d=https://a248.e.akamai.net/assets.github.com%2Fimages%2Fgravatars%2Fgravatar-user-420.png",
    "gravatar_id": "3dfe581ced82b6ab7d10429bc60541e1",
    "url": "https://api.github.com/users/fod",
    "login": "fod",
    "id": 163355
  },
  "history": [
    {
      "version": "301fff7fba1ee66150ecc340a0e19998a653a9e5",
      "change_status": {
        "total": 16,
        "deletions": 9,
        "additions": 7
      },
      "committed_at": "2011-04-03T01:07:17Z",
      "user": {
        "avatar_url": "https://secure.gravatar.com/avatar/005a27e09fe946ebef64bf4d134efc0a?d=https://a248.e.akamai.net/assets.github.com%2Fimages%2Fgravatars%2Fgravatar-user-420.png",
        "gravatar_id": "005a27e09fe946ebef64bf4d134efc0a",
        "url": "https://api.github.com/users/mbostock",
        "login": "mbostock",
        "id": 230541
      },
      "url": "https://api.github.com/gists/1071981/301fff7fba1ee66150ecc340a0e19998a653a9e5"
    },
    {
      "version": "c97da8195309e38361542a705d5d1ed4d7e2eb3c",
      "change_status": {
        "total": 2,
        "deletions": 1,
        "additions": 1
      },
      "committed_at": "2011-04-03T00:55:05Z",
      "user": {
        "avatar_url": "https://secure.gravatar.com/avatar/005a27e09fe946ebef64bf4d134efc0a?d=https://a248.e.akamai.net/assets.github.com%2Fimages%2Fgravatars%2Fgravatar-user-420.png",
        "gravatar_id": "005a27e09fe946ebef64bf4d134efc0a",
        "url": "https://api.github.com/users/mbostock",
        "login": "mbostock",
        "id": 230541
      },
      "url": "https://api.github.com/gists/1071981/c97da8195309e38361542a705d5d1ed4d7e2eb3c"
    },
    {
      "version": "84e724dae3ae048724f02fadf4bcec6f9f39d91c",
      "change_status": {
        "total": 98,
        "deletions": 46,
        "additions": 52
      },
      "committed_at": "2011-04-03T00:53:23Z",
      "user": {
        "avatar_url": "https://secure.gravatar.com/avatar/005a27e09fe946ebef64bf4d134efc0a?d=https://a248.e.akamai.net/assets.github.com%2Fimages%2Fgravatars%2Fgravatar-user-420.png",
        "gravatar_id": "005a27e09fe946ebef64bf4d134efc0a",
        "url": "https://api.github.com/users/mbostock",
        "login": "mbostock",
        "id": 230541
      },
      "url": "https://api.github.com/gists/1071981/84e724dae3ae048724f02fadf4bcec6f9f39d91c"
    },
    {
      "version": "a37ec8b5bdc5545e6562c5d47c200dc546960e94",
      "change_status": {
        "total": 217,
        "deletions": 0,
        "additions": 217
      },
      "committed_at": "2011-04-03T00:24:51Z",
      "user": {
        "avatar_url": "https://secure.gravatar.com/avatar/005a27e09fe946ebef64bf4d134efc0a?d=https://a248.e.akamai.net/assets.github.com%2Fimages%2Fgravatars%2Fgravatar-user-420.png",
        "gravatar_id": "005a27e09fe946ebef64bf4d134efc0a",
        "url": "https://api.github.com/users/mbostock",
        "login": "mbostock",
        "id": 230541
      },
      "url": "https://api.github.com/gists/1071981/a37ec8b5bdc5545e6562c5d47c200dc546960e94"
    }
  ],
  "url": "https://api.github.com/gists/1071981",
  "description": "d3.geo.tiler",
  "git_pull_url": "git://gist.github.com/1071981.git",
  "id": "1071981",
  "comments": 0,
  "created_at": "2011-07-08T14:39:45Z"
}
