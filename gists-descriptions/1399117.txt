{
  "git_pull_url": "git://gist.github.com/1399117.git",
  "forks": [

  ],
  "git_push_url": "git@gist.github.com:1399117.git",
  "updated_at": "2011-11-28T04:31:32Z",
  "public": true,
  "files": {
    "index.html": {
      "type": "text/html",
      "filename": "index.html",
      "language": "HTML",
      "content": "<!doctype html>\n<html>\n<head>\n<title>D3 for Mere Mortals</title>\n<script type=\"text/javascript\" src=\"http://www.recursion.org/d3.js\"></script>\n<script type=\"text/javascript\" src=\"http://www.recursion.org/d3.time.js\"></script>\n<script type=\"text/javascript\" src=\"http://www.recursion.org/jquery-1.6.2.min.js\"></script>\n<script type=\"text/javascript\" src=\"http://www.recursion.org/prettify.js\"></script>\n<link href=\"http://www.recursion.org/prettify.css\" type=\"text/css\" rel=\"stylesheet\"/>\n\n<style type=\"text/css\">\nbody {\n  width: 850px;\n  margin-left: auto;\n  margin-right: auto;\n  font-family: Helvetica, sans-serif;\n  font-size: 14px;\n}\n</style>\n\n<style type=\"text/css\" id=\"day-length-css\">\ndiv#day-length text {\n  fill: gray;\n  font-family: Helvetica, sans-serif;\n  font-size: 10px;\n}\n</style>\n\n</head>\n\n<body>\n\n<p>D3 shares similarities with its predecessor Protovis. However, instead of having its own graphical representation, D3 uses SVG (or HTML for simpler visualizations). This means that using D3 requires a fair amount of understanding of SVG. Fortunately, D3 provides a jQuery-like interface to the DOM, which means you will not have to endure the <a href=\"http://www.recursion.org/2006/1/20/xml-situps\">XML situps</a>.</p>\n\n<p>SVG provides basic shape primitives like <code>line</code>, <code>rect</code>, and <code>circle</code> as well as <code>text</code> and <code>path</code> to build complicated lines and shapes. If you think about a bar chart, you can see how you could make one of lines and rectangles with text for labels. D3 provides an API to help you place your rectangles in the correct location on the canvas.</p>\n\n<p>To place a rectangle on the canvas, you need to understand that the axis starts in the top left corner and counts up towards the bottom of the screen. An SVG <code>rect</code> is positioned from its top-left corner and has a width and height.</p>\n\n<p>Here's a diagram of a rectangle positioned at (100, 100) with a height of 100 pixels and a width of 200 pixels.<p>\n\n\n<p>To produce this with D3, add a container <code>div</code> to the page, and the following JavaScript code.<p>\n\n<pre class=\"code prettyprint\" data-id=\"rect-demo-js\"></pre>\n\n<p>The result looks like this.</p>\n\n<div id=\"rect-demo\"></div>\n\n<p>Not very impressive, eh? However, it does demonstrate how to use the D3 API to build an SVG document. The generated SVG code looks like this:</p>\n\n<pre class=\"prettyprint\">\n&lt;svg width=\"400\" height=\"300\"&gt;\n  &lt;rect x=\"100\" y=\"100\" height=\"100\" width=\"200\"&gt;&lt;/rect&gt;\n&lt;/svg&gt;\n</pre>\n\n<script type=\"text/javascript\" id=\"rect-demo-js\">\nvar rectDemo = d3.select(\"#rect-demo\").\n  append(\"svg:svg\").\n  attr(\"width\", 400).\n  attr(\"height\", 300);\n\nrectDemo.append(\"svg:rect\").\n  attr(\"x\", 100).\n  attr(\"y\", 100).\n  attr(\"height\", 100).\n  attr(\"width\", 200);\n</script>\n\n<h2>Drawing a Bar Chart</h2>\n\n<p>A vertical bar chart (or column chart) is basically a series of rectangles with the sizes proportional to the data being represented. D3 provides <a href=\"https://github.com/mbostock/d3/wiki/Quantitative-Scales\">scales</a> to translate between the input (your data) and the output (an x or y position on the canvas).</p>\n\n<h3>Understanding Scales</h3>\n\n<p>A linear scale is declared like this:\n\n<pre class=\"prettyprint\">\nvar xScale = d3.scale.linear().\n  domain([0, 20]). // your data minimum and maximum\n  range([0, 100]); // the pixels to map to, e.g., the width of the diagram.\n</pre>\n\n<p><code>d3.scale.linear()</code> returns a function which above is stored in the xScale variable. In use, the xScale function maps between data and pixel positions:</p>\n\n<pre class=\"prettyprint\">\nxScale(0) // => 0\nxScale(10) // => 50\nxScale(20) // => 100\n</pre>\n\n<p>In D3, scales can be used two ways to set the position of an element. If the data is a simple array of numbers, the scale itself can be passed to the <a href=\"https://github.com/mbostock/d3/wiki/Selections#attr\">attr</a> method:</p>\n\n<pre class=\"prettyprint\">\nattr(\"x\", xScale)\n</pre>\n\n<p>If the data is more complicated, or if you need to perform additional calculations to adjust the position, you can pass a function to <code>attr</code>. It takes two arguments: <code>datum</code> and <code>index</code> (which are often written as \"d\" and \"i\"). Remember that JavaScript functions can accept a variable number of arguments, so if you only need <code>datum</code> your function does not need to take <code>index</code>.</p>\n\n<p>Inside this function, you can call the scale function, manipulate the result, and return it.</p>\n\n<pre class=\"prettyprint\">\nattr(\"x\", function(datum, index) {\n  return xScale(datum.foobar) + whatever;\n})\n</pre>\n\n<p>Using a scale reduces the amount of math you need to do to lay out a visualization, but using them is not required.</p>\n\n<h3>Diagramming a Bar Chart</h3>\n\n<p>In the diagram below, a single <code>rect</code> from a bar chart is represented. The canvas is 300 pixels tall and the width is the number of data points multiplied by the bar width <em>bw</em>. There are two scale functions, <em>x</em> and <em>y</em>.</p>\n\n<p>The x position of the top left of the rectangle is easy: it is <code>x(i)</code> where <code>x</code> is the scale function and <code>i</code> is the index of the current datum. Since the SVG axis is located at the top of the graph, the height <em>h</em> is subtracted from the value of <em>y(datum)</em> to get the y position.</p>\n\n<p>The width is similarly easy, as it is defined to be <em>bw</em>. The height is <em>y(datum)</em>.<p>\n\n<img src=\"http://www.recursion.org/d3-for-mere-mortals/svg-bar-graph-diagram.png\" alt=\"diagram of a column graph in SVG\" width=\"570\" height=\"460\">\n\n<h3>Drawing the Bars</h3>\n\n<p>To give a concrete example, here is a bar graph showing <a href=\"http://www.recursion.org/2011/1/22/2010-books\">books read per year</a>.</p>\n\n<img src=\"http://www.recursion.org/d3-for-mere-mortals/books-per-year-smaller.png\" width=\"257\" height=\"228\">\n\n<p>To replicate this in D3, you will create a series of rectangles of the appropriate height along the x axis. D3's <a href=\"https://github.com/mbostock/d3/wiki/Quantitative-Scales#linear\">linear scale</a> will provide functions used to map a data point on the x and y axis.</p>\n\n<p>The data for the chart is a list of JavaScript objects with properties for year and number of books read. Since the years are continuous, there is no need to track them with the data, but doing so makes the code simpler to understand. The technique of using an array of JavaScript objects will be more useful for more complicated data, as you will see below.</p>\n\n<p>To draw the <code>rect</code>s, first use the <a href=\"https://github.com/mbostock/d3/wiki/Selections#d3_selectAll\">selectAll</a> method returns to create a selector, then use the <a href=\"https://github.com/mbostock/d3/wiki/Selections#data\">data</a> method to binds the array of data objects to the selection.  Calling <a href=\"https://github.com/mbostock/d3/wiki/Selections#enter\">enter</a> on the selection will create any objects that don't have corresponding elements in the data array.</p>\n\n<p>Since there's no existing <code>rect</code>s returned by the selector, one will be created for each data element, so it may seem superfluous. However, the <code>selectAll</code>/<code>data</code>/<code>enter</code> sequence can be used to add or remove elements from an existing list. Take a look at the <a href=\"http://mbostock.github.com/d3/tutorial/circle.html\">Three Little Circles</a> demo for more about <code>data</code> and <code>enter</code>.</p>\n\n<p>The rest of the diagram all comes down to positioning and formatting.</p>\n\n<pre class=\"code prettyprint\" data-id=\"bar-demo-js\"></pre>\n\n<p>The result looks like this:</p>\n\n<div id=\"bar-demo\"></div>\n\n<script type=\"text/javascript\" id=\"bar-demo-js\">\nvar data = [{year: 2006, books: 54},\n            {year: 2007, books: 43},\n            {year: 2008, books: 41},\n            {year: 2009, books: 44},\n            {year: 2010, books: 35}];\n\nvar barWidth = 40;\nvar width = (barWidth + 10) * data.length;\nvar height = 200;\n\nvar x = d3.scale.linear().domain([0, data.length]).range([0, width]);\nvar y = d3.scale.linear().domain([0, d3.max(data, function(datum) { return datum.books; })]).\n  rangeRound([0, height]);\n\n// add the canvas to the DOM\nvar barDemo = d3.select(\"#bar-demo\").\n  append(\"svg:svg\").\n  attr(\"width\", width).\n  attr(\"height\", height);\n\nbarDemo.selectAll(\"rect\").\n  data(data).\n  enter().\n  append(\"svg:rect\").\n  attr(\"x\", function(datum, index) { return x(index); }).\n  attr(\"y\", function(datum) { return height - y(datum.books); }).\n  attr(\"height\", function(datum) { return y(datum.books); }).\n  attr(\"width\", barWidth).\n  attr(\"fill\", \"#2d578b\");\n</script>\n\n<h3>Adding Text and Axes</h3>\n\n<p>To add numbers inside the bars, <a href=\"http://www.w3.org/TR/SVG/text.html\">svg:text</a> elements must be positioned in the same place as the top of the bar and padding added to make it look right. The <code>svg:text</code> element has a lot of attributes for positioning and formatting. In this example, <a href=\"http://www.w3.org/TR/SVG/text.html#TextElementDXAttribute\">dx</a>, <a href=\"http://www.w3.org/TR/SVG/text.html#TextElementDYAttribute\">dy</a>, <a href=\"http://www.w3.org/TR/SVG/text.html#TextAnchorProperty\">text-anchor</a> and <a href=\"http://www.w3.org/TR/SVG/styling.html#StyleAttribute\">style</a> are used.</p>\n\n<p>Again, <code>selectAll</code> is used get a selection of elements, data is bound to them with <code>data</code> and then <code>enter</code> is used to add the elements to to the chart.</p>\n\n<pre class=\"code prettyprint\" data-id=\"bar-demo-part2-js\"></pre>\n\n<div id=\"bar-demo-part2\"></div>\n\n<script type=\"text/javascript\">\n\nvar barDemo = d3.select(\"#bar-demo-part2\").\n  append(\"svg:svg\").\n  attr(\"width\", width).\n  attr(\"height\", height);\n\nbarDemo.selectAll(\"rect\").\n  data(data).\n  enter().\n  append(\"svg:rect\").\n  attr(\"x\", function(datum, index) { return x(index); }).\n  attr(\"y\", function(datum) { return height - y(datum.books); }).\n  attr(\"height\", function(datum) { return y(datum.books); }).\n  attr(\"width\", barWidth).\n  attr(\"fill\", \"#2d578b\");\n</script>\n\n<script type=\"text/javascript\" id=\"bar-demo-part2-js\">\nbarDemo.selectAll(\"text\").\n  data(data).\n  enter().\n  append(\"svg:text\").\n  attr(\"x\", function(datum, index) { return x(index) + barWidth; }).\n  attr(\"y\", function(datum) { return height - y(datum.books); }).\n  attr(\"dx\", -barWidth/2).\n  attr(\"dy\", \"1.2em\").\n  attr(\"text-anchor\", \"middle\").\n  text(function(datum) { return datum.books;}).\n  attr(\"fill\", \"white\");\n</script>\n\n<p>To add an x axis, the height of the chart must be increased to make room. A padding of 30 pixels will work nicely. By keeping the old <code>height</code> variable and increasing the height of the <code>svg:svg</code> canvas by <code>padding</code>, the rest of the code does not need to change. The axis could be positioned by using <code>height + padding</code> as the baseline, but using translate makes the x and y attributes simpler.</p>\n\n<pre class=\"code prettyprint\" data-id=\"bar-demo-part3-js\"></pre>\n\n<p>The font has also been changed to closer match the template. This can also be done with CSS, as you'll see in the next example.</p>\n\n<p>And the result:</p>\n\n<div id=\"bar-demo-part3\"></div>\n\n<script type=\"text/javascript\">\nvar padding = 30;\nvar barDemo = d3.select(\"#bar-demo-part3\").\n  append(\"svg:svg\").\n  attr(\"width\", width).\n  attr(\"height\", height + padding);\n\nbarDemo.selectAll(\"rect\").\n  data(data).\n  enter().\n  append(\"svg:rect\").\n  attr(\"x\", function(datum, index) { return x(index); }).\n  attr(\"y\", function(datum) { return height - y(datum.books); }).\n  attr(\"height\", function(datum) { return y(datum.books); }).\n  attr(\"width\", barWidth).\n  attr(\"fill\", \"#2d578b\");\n\nbarDemo.selectAll(\"text\").\n  data(data).\n  enter().append(\"svg:text\").\n  attr(\"x\", function(datum, index) { return x(index) + barWidth; }).\n  attr(\"y\", function(datum) { return height - y(datum.books); }).\n  attr(\"dx\", -barWidth/2).\n  attr(\"dy\", \"1.2em\").\n  attr(\"text-anchor\", \"middle\").\n  attr(\"style\", \"font-size: 12; font-family: Helvetica, sans-serif;\").\n  text(function(datum) { return datum.books;}).\n  attr(\"fill\", \"white\");\n</script>\n\n<script type=\"text/javascript\" id=\"bar-demo-part3-js\">\nbarDemo.selectAll(\"text.yAxis\").\n  data(data).\n  enter().append(\"svg:text\").\n  attr(\"x\", function(datum, index) { return x(index) + barWidth; }).\n  attr(\"y\", height).\n  attr(\"dx\", -barWidth/2).\n  attr(\"text-anchor\", \"middle\").\n  attr(\"style\", \"font-size: 12; font-family: Helvetica, sans-serif\").\n  text(function(datum) { return datum.year;}).\n  attr(\"transform\", \"translate(0, 18)\").\n  attr(\"class\", \"yAxis\");\n</script>\n\n\n<h2>Drawing a Custom Visualization</h2>\n\n<p>So far, you would have been better off using <a href=\"http://code.google.com/apis/chart/\">Google Chart Tools</a> to produce a simple chart like this. But this barely scratches the surface of what D3 is capable of. A more complicated example will show how you can make custom visualizations with D3 that are impossible with standard charting libraries. This is where D3 really shines.</p>\n\n<p>The goal is to make a chart of day lengths throughout the year, like this one <a href=\"http://radiochildcare.org/AstronomyWithChildren/Day_Length_Thru_the_Year.html\">drawn by a child from M&M child care</a>.</p>\n\n<img src=\"http://www.recursion.org/d3-for-mere-mortals/mm-day-length-graph.jpg\" width=\"700\" height=\"533\">\n\n<p>This chart has several interesting aspects that are worth noting. It is centered on noon and the length of the day is shown with two lines over the central axis, which forms a shape which is colored in and the background is blue to represent night. There are four labeled axes, top and bottom and left and right. Building a visualization like it is not likely to come from a pre-packaged library.</p>\n\n<h3>Planning the Visualization</h3>\n\n<p>To plan the attack, a diagram of the desired visualization is helpful.</p>\n\n<img src=\"http://www.recursion.org/d3-for-mere-mortals/svg-sunrise-sunset-diagram.png\" width=\"515\" height=\"446\">\n\n<p>This brings several points to the foreground:</p>\n\n<ul>\n<li>The visualization will be inset with a margin of 40 pixels to print the axes. Using transform will make the math for this simple.</li>\n<li>Axes will go above and below and left and right of the graphic. Since the axes are all time-related, it makes sense to use <a href=\"https://github.com/mbostock/d3/wiki/Time-Scales\">time scales</a>.</li>\n<li>Helpfully, the y axis counts up the same way as the SVG coordinate system so you do not need to reverse the axis.</li>\n<li>The sunrise section will be yellow and will be made up of what is left of a rect after drawing shapes with a <code>svg:path</code> for sunrise time and sunset time. <a href=\"https://github.com/mbostock/d3/wiki/SVG-Shapes#area\">d3.svg.area</a> makes this easy.</li>\n<li>The points on the path need to be connected into a smooth curve. There are different kinds of <a href=\"https://github.com/mbostock/d3/wiki/SVG-Shapes#area_interpolate\">interpolation</a> for this.\n</ul>\n\n<h3>New Concepts</h3>\n\n<p>For this example, some new concepts will be introduced:</p>\n\n<ul>\n  <li><a href=\"https://github.com/mbostock/d3/wiki/Time-Scales\">Time scales</a>, an extension of linear scales tailored for time values.</li>\n  <li>The <a href=\"http://www.w3.org/TR/SVG/struct.html#Groups\">svg:g</a> element which groups other elements like a <code>div</code> and can be transformed as a group.</li>\n  <li>Drawing complex shapes with <a href=\"http://www.w3.org/TR/SVG/paths.html#PathElement\">svg:path</a>, which is complicated, but made easy with the <a href=\"https://github.com/mbostock/d3/wiki/SVG-Shapes#area\">d3.svg.area</a> function.</li>\n  <li>Using <a href=\"https://github.com/mbostock/d3/wiki/Arrays#d3_range\">d3.range</a> to create an array of numbers.</li>\n  <li>Using <a href=\"https://github.com/mbostock/d3/wiki/Time-Scales#ticks\">scale.ticks</a> to generate tick marks for the axes.</li>\n  <li>Using SVG translation to simplify positioning.</li>\n  <li>Styling text with CSS.</li>\n  <li>Adjusting pixel positions to avoid anti-aliasing</li>\n</ul>\n\n<h3>Digression: Anti-aliasing</h3>\n\n<p>Anti-aliasing helps make text and curved lines look smoother, but can make straight lines appear fuzzy. If you are using a WebKit-based browser, the lines on the left should be fuzzy, while those on the right should be crisp.</p>\n\n<div id=\"antialias-demo\"></div>\n\n<script type=\"text/javascript\">\nvar antialias = d3.select(\"#antialias-demo\").\n  append(\"svg:svg\").\n  attr(\"width\", 200).\n  attr(\"height\", 100);\n\nantialias.append(\"svg:line\").\n  attr(\"x1\", 10).\n  attr(\"y1\", 50).\n  attr(\"x2\", 90).\n  attr(\"y2\", 50).\n  attr(\"stroke\", \"black\");\n\nantialias.append(\"svg:line\").\n  attr(\"x1\", 50).\n  attr(\"y1\", 10).\n  attr(\"x2\", 50).\n  attr(\"y2\", 90).\n  attr(\"stroke\", \"black\");\n\nantialias.append(\"svg:line\").\n  attr(\"x1\", 100).\n  attr(\"y1\", 50.5).\n  attr(\"x2\", 180).\n  attr(\"y2\", 50.5).\n  attr(\"stroke\", \"black\");\n\nantialias.append(\"svg:line\").\n  attr(\"x1\", 140.5).\n  attr(\"y1\", 10).\n  attr(\"x2\", 140.5).\n  attr(\"y2\", 90).\n  attr(\"stroke\", \"black\");\n</script>\n\n<p>Anti-aliasing often happens when drawing straight lines with D3. If the line is 1 pixel tall and positioned exactly on a pixel, it will straddle the pixel and become fuzzy. To avoid it, add or subtract 0.5 to the pixel position. The example below uses this technique to prevent fuzziness.</p>\n\n<p>However, rendering differs depending on the SVG layout engine. In the example above, Firefox 5 renders fuzzy vertical lines when positioned exactly on a pixel, while the horizontal lines are not.</p>\n\n<p>Setting the SVG <code>shape-rendering</code> property to <code>crispEdges</code> disables anti-aliasing for some or all lines. However, this may have unwanted side-effects if the visualization has curved lines, making them look jagged.</p>\n\n<pre class=\"prettyprint\">\nsvg {\n  shape-rendering: crispEdges;\n}\n</pre>\n\n<p>A better solution may be to target the <code>crispEdges</code> property at certain (vertical or horizontal) lines with a CSS class.</p>\n\n<pre class=\"prettyprint\">\nline.crisp {\n  shape-rendering: crispEdges;\n}\n</pre>\n\n<p>Using this solution without pixel munging seems to work better across different browsers, but you should test it yourself and see what works best for your audience.</p>\n\n<h3>Getting the Data</h3>\n\n<p>Having game-planned the graphic, the first step is to collect the data. You can find sunrise and sunset times for cities around the world at <a href=\"http://www.timeanddate.com/\">timeanddate.com</a>. I could not find a source of sunrise and sunset times in a computer-readable format and didn't feel like writing a scraper, so I selected a few days throughout the year for the selected location (Minneapolis, Minnesota).</p>\n\n<p>The data format is like this:</p>\n\n<pre class=\"prettyprint\">\n{\n date: new Date(2011, 4, 15), // day of year\n sunrise: [7, 51],            // sunrise time as array of hours and minutes\n sunset: [16, 42]             // likewise, sunset time (24 hour clock)\n}\n</pre>\n\n<p>Sunrise and sunset times are stored as an array of hour and minute values. These are used to construct a <code>Date</code> to represent the time of day when plotting.</p>\n\n<h3>Building the Visualization</h3>\n\n<p>The JavaScript code for the visualization is below, with comments in line.</p>\n\n<pre class=\"code prettyprint\" data-id=\"day-length-js\"></pre>\n\nUsing CSS helps remove duplication from the text formatting attributes:\n\n<pre class=\"code prettyprint\" data-id=\"day-length-css\"></pre>\n\nAnd the final result:\n\n<div id=\"day-length\"></div>\n\n<script type=\"text/javascript\" id=\"day-length-js\">\nvar width = 700;\nvar height = 525;\nvar padding = 40;\n\n// the vertical axis is a time scale that runs from 00:00 - 23:59\n// the horizontal axis is a time scale that runs from the 2011-01-01 to 2011-12-31\n\nvar y = d3.time.scale().domain([new Date(2011, 0, 1), new Date(2011, 0, 1, 23, 59)]).range([0, height]);\nvar x = d3.time.scale().domain([new Date(2011, 0, 1), new Date(2011, 11, 31)]).range([0, width]);\n\nvar monthNames = [\"Jan\", \"Feb\", \"Mar\", \"April\", \"May\", \"Jun\", \"Jul\", \"Aug\", \"Sep\", \"Oct\", \"Nov\", \"Dec\"];\n\n// Sunrise and sun set times for dates in 2011. I have picked the 1st\n// and 15th day of every month, plus other important dates like equinoxes\n// and solstices and dates around the standard time/DST transition.\n\nvar data = [\n  {date: new Date(2011, 0, 1), sunrise: [7, 51], sunset: [16, 42]},\n  {date: new Date(2011, 0, 15), sunrise: [7, 48], sunset: [16, 58]},\n  {date: new Date(2011, 1, 1), sunrise: [7, 33], sunset: [17, 21]},\n  {date: new Date(2011, 1, 15), sunrise: [7, 14], sunset: [17, 41]},\n  {date: new Date(2011, 2, 1), sunrise: [6, 51], sunset: [18, 0]},\n  {date: new Date(2011, 2, 12), sunrise: [6, 32], sunset: [18, 15]}, // dst - 1 day\n  {date: new Date(2011, 2, 13), sunrise: [7, 30], sunset: [19, 16]}, // dst\n  {date: new Date(2011, 2, 14), sunrise: [7, 28], sunset: [19, 18]}, // dst + 1 day\n  {date: new Date(2011, 2, 14), sunrise: [7, 26], sunset: [19, 19]},\n  {date: new Date(2011, 2, 20), sunrise: [07, 17], sunset: [19, 25]}, // equinox\n  {date: new Date(2011, 3, 1), sunrise: [6, 54], sunset: [19, 41]},\n  {date: new Date(2011, 3, 15), sunrise: [6, 29], sunset: [19, 58]},\n  {date: new Date(2011, 4, 1), sunrise: [6, 3], sunset: [20, 18]},\n  {date: new Date(2011, 4, 15), sunrise: [5, 44], sunset: [20, 35]},\n  {date: new Date(2011, 5, 1), sunrise: [5, 30], sunset: [20, 52]},\n  {date: new Date(2011, 5, 15), sunrise: [5, 26], sunset: [21, 1]},\n  {date: new Date(2011, 5, 21), sunrise: [5, 26], sunset: [21, 3]}, // solstice\n  {date: new Date(2011, 6, 1), sunrise: [5, 30], sunset: [21, 3]},\n  {date: new Date(2011, 6, 15), sunrise: [5, 41], sunset: [20, 57]},\n  {date: new Date(2011, 7, 1), sunrise: [5, 58], sunset: [20, 40]},\n  {date: new Date(2011, 7, 15), sunrise: [6, 15], sunset: [20, 20]},\n  {date: new Date(2011, 8, 1), sunrise: [6, 35], sunset: [19, 51]},\n  {date: new Date(2011, 8, 15), sunrise: [6, 51], sunset: [19, 24]},\n  {date: new Date(2011, 8, 23), sunrise: [7, 1], sunset: [19, 9]}, // equinox\n  {date: new Date(2011, 9, 1), sunrise: [7, 11], sunset: [18, 54]},\n  {date: new Date(2011, 9, 15), sunrise: [7, 28], sunset: [18, 29]},\n  {date: new Date(2011, 10, 1), sunrise: [7, 51], sunset: [18, 2]},\n  {date: new Date(2011, 10, 5), sunrise: [7, 57], sunset: [17, 56]}, // last day of dst\n  {date: new Date(2011, 10, 6), sunrise: [6, 58], sunset: [16, 55]}, // standard time\n  {date: new Date(2011, 10, 7), sunrise: [6, 59], sunset: [16, 54]}, // standard time + 1\n  {date: new Date(2011, 10, 15), sunrise: [7, 10], sunset: [16, 44]},\n  {date: new Date(2011, 11, 1), sunrise: [7, 31], sunset: [16, 33]},\n  {date: new Date(2011, 11, 15), sunrise: [7, 44], sunset: [16, 32]},\n  {date: new Date(2011, 11, 22), sunrise: [7, 49], sunset: [16, 35]}, // solstice\n  {date: new Date(2011, 11, 31), sunrise: [7, 51], sunset: [16, 41]}\n];\n\nfunction yAxisLabel(d) {\n  if (d == 12) { return \"noon\"; }\n  if (d < 12) { return d; }\n  return (d - 12);\n}\n\n// The labels along the x axis will be positioned on the 15th of the\n// month\n\nfunction midMonthDates() {\n  return d3.range(0, 12).map(function(i) { return new Date(2011, i, 15) });\n}\n\nvar dayLength = d3.select(\"#day-length\").\n  append(\"svg:svg\").\n  attr(\"width\", width + padding * 2).\n  attr(\"height\", height + padding * 2);\n\n// create a group to hold the axis-related elements\nvar axisGroup = dayLength.append(\"svg:g\").\n  attr(\"transform\", \"translate(\"+padding+\",\"+padding+\")\");\n\n// draw the x and y tick marks. Since they are behind the visualization, they\n// can be drawn all the way across it. Because the <g> has been\n// translated, they stick out the left side by going negative.\n\naxisGroup.selectAll(\".yTicks\").\n  data(d3.range(5, 22)).\n  enter().append(\"svg:line\").\n  attr(\"x1\", -5).\n  // Round and add 0.5 to fix anti-aliasing effects (see above)\n  attr(\"y1\", function(d) { return d3.round(y(new Date(2011, 0, 1, d))) + 0.5; }).\n  attr(\"x2\", width+5).\n  attr(\"y2\", function(d) { return d3.round(y(new Date(2011, 0, 1, d))) + 0.5; }).\n  attr(\"stroke\", \"lightgray\").\n  attr(\"class\", \"yTicks\");\n\naxisGroup.selectAll(\".xTicks\").\n  data(midMonthDates).\n  enter().append(\"svg:line\").\n  attr(\"x1\", x).\n  attr(\"y1\", -5).\n  attr(\"x2\", x).\n  attr(\"y2\", height+5).\n  attr(\"stroke\", \"lightgray\").\n  attr(\"class\", \"yTicks\");\n\n// draw the text for the labels. Since it is the same on top and\n// bottom, there is probably a cleaner way to do this by copying the\n// result and translating it to the opposite side\n\naxisGroup.selectAll(\"text.xAxisTop\").\n  data(midMonthDates).\n  enter().\n  append(\"svg:text\").\n  text(function(d, i) { return monthNames[i]; }).\n  attr(\"x\", x).\n  attr(\"y\", -8).\n  attr(\"text-anchor\", \"middle\").\n  attr(\"class\", \"axis xAxisTop\");\n\naxisGroup.selectAll(\"text.xAxisBottom\").\n  data(midMonthDates).\n  enter().\n  append(\"svg:text\").\n  text(function(d, i) { return monthNames[i]; }).\n  attr(\"x\", x).\n  attr(\"y\", height+15).\n  attr(\"text-anchor\", \"middle\").\n  attr(\"class\", \"xAxisBottom\");\n\naxisGroup.selectAll(\"text.yAxisLeft\").\n  data(d3.range(5, 22)).\n  enter().\n  append(\"svg:text\").\n  text(yAxisLabel).\n  attr(\"x\", -7).\n  attr(\"y\", function(d) { return y(new Date(2011, 0, 1, d)); }).\n  attr(\"dy\", \"3\").\n  attr(\"class\", \"yAxisLeft\").\n  attr(\"text-anchor\", \"end\");\n\naxisGroup.selectAll(\"text.yAxisRight\").\n  data(d3.range(5, 22)).\n  enter().\n  append(\"svg:text\").\n  text(yAxisLabel).\n  attr(\"x\", width+7).\n  attr(\"y\", function(d) { return y(new Date(2011, 0, 1, d)); }).\n  attr(\"dy\", \"3\").\n  attr(\"class\", \"yAxisRight\").\n  attr(\"text-anchor\", \"start\");\n\n// create a group for the sunrise and sunset paths\n\nvar lineGroup = dayLength.append(\"svg:g\").\n  attr(\"transform\", \"translate(\"+ padding + \", \" + padding + \")\");\n\n// draw the background. The part of this that remains uncovered will\n// represent the daylight hours.\n\nlineGroup.append(\"svg:rect\").\n  attr(\"x\", 0).\n  attr(\"y\", 0).\n  attr(\"height\", height).\n  attr(\"width\", width).\n  attr(\"fill\", \"lightyellow\");\n\n// The meat of the visualization is surprisingly simple. sunriseLine\n// and sunsetLine are areas (closed svg:path elements) that use the date\n// for the x coordinate and sunrise and sunset (respectively) for the y\n// coordinate. The sunrise shape is anchored at the top of the chart, and\n// sunset area is anchored at the bottom of the chart.\n\nvar sunriseLine = d3.svg.area().\n  x(function(d) { return x(d.date); }).\n  y1(function(d) { return y(new Date(2011, 0, 1, d.sunrise[0], d.sunrise[1])); }).\n  interpolate(\"linear\");\n\nlineGroup.\n  append(\"svg:path\").\n  attr(\"d\", sunriseLine(data)).\n  attr(\"fill\", \"steelblue\");\n\nvar sunsetLine = d3.svg.area().\n  x(function(d) { return x(d.date); }).\n  y0(height).\n  y1(function(d) { return y(new Date(2011, 0, 1, d.sunset[0], d.sunset[1])); }).\n  interpolate(\"linear\");\n\nlineGroup.append(\"svg:path\").\n  attr(\"d\", sunsetLine(data)).\n  attr(\"fill\", \"steelblue\");\n\n// finally, draw a line representing 12:00 across the entire\n// visualization\n\nlineGroup.append(\"svg:line\").\n  attr(\"x1\", 0).\n  attr(\"y1\", d3.round(y(new Date(2011, 0, 1, 12))) + 0.5).\n  attr(\"x2\", width).\n  attr(\"y2\", d3.round(y(new Date(2011, 0, 1, 12))) + 0.5).\n  attr(\"stroke\", \"lightgray\");\n</script>\n\n<h3>Next Steps</h3>\n\n<p>Now that the visualization is complete, think of what could be done to improve it. You could label the solstices and equinoxes with exact times, or plot different sunset and sunrise times for different locations against each other, or make a label that shows exact times for the day the user is are mousing over...</p>\n\n<p>The possibilities are endless.</p>\n\n<h2>Debugging D3</h2>\n\n<p>Lest you assume these examples were coded straight through, let me assure you this was not the case. There was a significant amount of trial-and-error coding needed to get them working.</p>\n\n<p>One of the advantages of D3 using SVG as its native graphical representation is that it is easier to debug the WebKit Inspector or Firebug.</p>\n\n<img src=\"http://www.recursion.org/d3-for-mere-mortals/svg-code-inspector.png\" width=\"516\" height=\"70\" alt=\"SVG in the WebKit Inspector\">\n\n<p>This is incredibly useful. You can try it on this page to see how the SVG code for these examples is generated.</p>\n\n<p>Another technique that has been helpful for me is to use <code>console.log</code> in positioning functions. This lets you inspect the datum and index of an element as well as the calculated position for the x or y value. For example:</p>\n\n<pre class=\"prettyprint\">\nattr(\"x\", function(d, i) {\n  console.log(d);\n  console.log(i);\n\n  return x(d.whatever);\n})\n</pre>\n\n<h2>Further Reading</h2>\n\n<p>Now you know about as much about D3 as I do. Obviously, this barely scratches the surface. For more tutorials and resources about D3, read the following articles:</p> \n\n<ul>\n  <li>The <a href=\"http://mbostock.github.com/d3/\">D3 homepage</a>, <a href=\"http://mbostock.github.com/d3/ex/\">examples</a> (don't miss the examples <a href=\"https://github.com/mbostock/d3/tree/master/examples\">only in the source code</a>), and <a href=\"https://github.com/mbostock/d3/wiki/API-Reference\">API documentation</a>.</li>\n  <li>The D3 tutorials <a href=\"http://mbostock.github.com/d3/tutorial/circle.html\">Three Little Circles</a>, <a href=\"http://mbostock.github.com/d3/tutorial/bar-1.html\">A Bar Chart, Part 1</a>, and <a href=\"http://mbostock.github.com/d3/tutorial/bar-2.html\">A Bar Chart, Part 2</a></li>\n  <li>Jan Willem Tulp's <a href=\"\">D3 blog category</a> especially <a href=\"http://www.janwillemtulp.com/2011/03/20/tutorial-introduction-to-d3/\">Tutorial: Introduction to D3</a> and <a href=\"http://www.janwillemtulp.com/2011/04/01/tutorial-line-chart-in-d3/\">Tutorial: Line chart in D3</a>.</li>\n  <li><a href=\"http://nelsonslog.wordpress.com/2011/04/11/d3-scales-and-interpolation/\">D3 scales and interpolation</a> by Nelson Minar.</li>\n  <li><a href=\"http://www.jeromecukier.net/blog/2011/08/11/d3-scales-and-color/\">D3: Scales and Color</a> by Jerome Cukier (with nice diagrams explaining scales).</li>\n  <li><a href=\"http://www.verisi.com/resources/d3-tutorial-basic-charts.htm\">Creating Basic Charts using d3.js</a> by Ben Lorica (view source to see the D3 code).</li>\n  <li><a href=\"http://christopheviau.com/d3_tutorial/\">Try D3 Now</a> by Christophe Viau.</li>\n  <li><a href=\"http://dealloc.me/2011/06/24/d3-is-not-a-graphing-library.html\">D3.js is Not a Graphing Library, Let's Design a Line Graph</a> by Justin Palmer.</li>\n</ul>\n\n<p>You also need to read about SVG to know what's possible &ndash; because with D3, you can do anything SVG can do.</p>\n\n<ul>\n  <li>The <a href=\"http://www.w3.org/TR/SVG/\">SVG spec</a> is a good place to start.</li>\n  <li><a href=\"http://www.learnsvg.com/book-learnsvg/\">Learn SVG</a> by Jon Frost, Stefan Goesser and Michel Hirtzler provides a gentler introduction.</li>\n</ul>\n\n<p>That's it for now. I hope this tutorial was helpful for you.</p>\n\n<hr>\n\nReturn to <a href=\"/\">recursion</a>. <a href=\"http://luke.francl.org/\">More about me</a>.\n\n<script type=\"text/javascript\">\n$(function() {\n  $(\"pre.code\").each(function() { $(this).html($(\"#\" + $(this).data(\"id\")).text().trim()); });\n  prettyPrint();\n})\n</script>\n\n<script type=\"text/javascript\">\n var _gaq = _gaq || [];\n  _gaq.push(['_setAccount', 'UA-13262353-1']);\n  _gaq.push(['_trackPageview']);\n\n  (function() {\n    var ga = document.createElement('script'); ga.type = 'text/javascript'; ga.async = true;\n    ga.src = ('https:' == document.location.protocol ? 'https://ssl' : 'http://www') + '.google-analytics.com/ga.js';\n    var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(ga, s);\n  })();\n</script>\n\n</body>\n</html>",
      "raw_url": "https://gist.github.com/raw/1399117/b42008373dc38d7387e3e4e21aea815770f80d12/index.html",
      "size": 31736
    }
  },
  "user": {
    "gravatar_id": "b97c33508cef9f4d2324e074c98524ad",
    "url": "https://api.github.com/users/captproton",
    "avatar_url": "https://secure.gravatar.com/avatar/b97c33508cef9f4d2324e074c98524ad?d=https://a248.e.akamai.net/assets.github.com%2Fimages%2Fgravatars%2Fgravatar-user-420.png",
    "login": "captproton",
    "id": 583
  },
  "history": [
    {
      "version": "0326801a0ea503d64684fa936563fa1a6ad1f177",
      "user": {
        "gravatar_id": "b97c33508cef9f4d2324e074c98524ad",
        "url": "https://api.github.com/users/captproton",
        "avatar_url": "https://secure.gravatar.com/avatar/b97c33508cef9f4d2324e074c98524ad?d=https://a248.e.akamai.net/assets.github.com%2Fimages%2Fgravatars%2Fgravatar-user-420.png",
        "login": "captproton",
        "id": 583
      },
      "url": "https://api.github.com/gists/1399117/0326801a0ea503d64684fa936563fa1a6ad1f177",
      "change_status": {
        "total": 1,
        "deletions": 1,
        "additions": 0
      },
      "committed_at": "2011-11-28T04:35:42Z"
    },
    {
      "version": "519f9c6d418ad3a6ed34d5385be803cb951a8161",
      "user": {
        "gravatar_id": "b97c33508cef9f4d2324e074c98524ad",
        "url": "https://api.github.com/users/captproton",
        "avatar_url": "https://secure.gravatar.com/avatar/b97c33508cef9f4d2324e074c98524ad?d=https://a248.e.akamai.net/assets.github.com%2Fimages%2Fgravatars%2Fgravatar-user-420.png",
        "login": "captproton",
        "id": 583
      },
      "url": "https://api.github.com/gists/1399117/519f9c6d418ad3a6ed34d5385be803cb951a8161",
      "change_status": {
        "total": 13,
        "deletions": 13,
        "additions": 0
      },
      "committed_at": "2011-11-28T04:34:52Z"
    },
    {
      "version": "11695a2a2f9bcd8ead6077e306dcde73e12f3a4b",
      "user": {
        "gravatar_id": "b97c33508cef9f4d2324e074c98524ad",
        "url": "https://api.github.com/users/captproton",
        "avatar_url": "https://secure.gravatar.com/avatar/b97c33508cef9f4d2324e074c98524ad?d=https://a248.e.akamai.net/assets.github.com%2Fimages%2Fgravatars%2Fgravatar-user-420.png",
        "login": "captproton",
        "id": 583
      },
      "url": "https://api.github.com/gists/1399117/11695a2a2f9bcd8ead6077e306dcde73e12f3a4b",
      "change_status": {
        "total": 695,
        "deletions": 0,
        "additions": 695
      },
      "committed_at": "2011-11-28T04:31:32Z"
    }
  ],
  "html_url": "https://gist.github.com/1399117",
  "url": "https://api.github.com/gists/1399117",
  "description": "d3 for mere mortals",
  "id": "1399117",
  "comments": 0,
  "created_at": "2011-11-28T04:31:32Z"
}
